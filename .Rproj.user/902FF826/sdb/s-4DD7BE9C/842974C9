{
    "collab_server" : "",
    "contents" : "\nlibrary(rgdal)\nlibrary(GSIF)\nlibrary(gdalUtils)\nlibrary(raster)\nlibrary(plyr)\nlibrary(aqp)\nlibrary(psych)\nlibrary(mda)\nlibrary(classInt)\nlibrary(caret)\nlibrary(corrplot)\nlibrary(MASS)\nlibrary(splines)\nlibrary(glmnet)\nlibrary(glinternet)\nlibrary(hierNet)\n\ngk_7 <- \"+proj=tmerc +lat_0=0 +lon_0=21 +k=0.9999 +x_0=7500000 +y_0=0 +ellps=bessel +towgs84=574.027,170.175,401.545,4.88786,-0.66524,-13.24673,0.99999311067 +units=m\"\nutm <- \"+proj=utm +zone=34 +ellps=GRS80 +towgs84=0.26901,0.18246,0.06872,-0.01017,0.00893,-0.01172,0.99999996031 +units=m\"\n\nload(paste(getwd(),\"inst\",\"extdata\",\"gridmaps.RDa\",sep=\"/\"))\nbor <- join(read.csv(paste(getwd(),\"inst\",\"extdata\",\"Profili_sredjeno_csv.csv\",sep=\"/\")), read.csv(paste(getwd(),\"inst\",\"extdata\",\"Koordinate_csv.csv\",sep=\"/\")), type=\"inner\")\nbor$altitude <- - (bor$Top / 100 + (( bor$Bottom - bor$Top ) / 2) / 100)\nbor <- bor[, - c( 7:12,14,15,16,17 )]\nnames(bor) <- c(\"Soil.Type\",\"ID\",\"Horizont\",\"Top\" , \"Bottom\",\"pH\",\"Humus\",\"As\",\"Co\",\"x\",\"y\",\"altitude\")\n\nbor.Humus.xy <- bor[complete.cases(bor[,c(\"ID\",\"x\",\"y\",\"altitude\",\"Humus\")]),c(\"ID\",\"x\",\"y\",\"altitude\",\"Humus\")] \nbor.Humus.xy <- plyr::rename(bor.Humus.xy, replace=c(\"x\" = \"longitude\", \"y\" = \"latitude\"))\ncoordinates(bor.Humus.xy) <- ~ longitude + latitude\nproj4string(bor.Humus.xy) <- CRS(utm)\nbor.Humus.xy <- spTransform(bor.Humus.xy, CRS(gk_7))\n\nsm2D.lst<-names(gridmaps.sm2D)\n\n#=========== Overlay with covariates (gridmaps.sm2D) ================================\nov.H <- over(bor.Humus.xy, gridmaps.sm2D)\nbor.Humus.xy@data[,c(sm2D.lst)] <- ov.H\nstr(bor.Humus.xy)\n\nbor.Humus.df <- data.frame(bor.Humus.xy)\nbor.Humus.df <- bor.Humus.df[complete.cases(bor.Humus.df[,names(bor.Humus.df)]),]\nstr(bor.Humus.df)\n\n#============== Removing correlated covariates (previously determined) ==============\nnames(bor.Humus.df)\nbor.Humus.df<-bor.Humus.df[,-which(names(bor.Humus.df) %in% c(\"AnalyticalHills\",\"LSFactor\",\"ChannelNetBaseLevel\",\"RelSlopePosition\",\"CatchArea\",\"WindEffectNorthWest\",\"VelleyDepth\",\"optional\"))]\nstr(bor.Humus.df)\n\n#bor.Humus.df<-bor.Humus.df[-which(bor.Humus.df$ID %in% c(141)),] #153,137,141,145,150\n\n#============== Sorting by altitude =================================================\nH.df<-ddply(bor.Humus.df,.(altitude))\nH.df <- H.df[order(-H.df$altitude),] \nhead(H.df)\nnames(H.df)\n\nsm2D.lst<-names(H.df)[c(4:16)]\n\n#====================== formulas ===================================================\nfm.H <- as.formula(paste(\"Humus ~\", paste(c(sm2D.lst,\"altitude\"), collapse=\"+\")))\nfm.int.H<- as.formula(paste(\"Humus ~\",paste(sm2D.lst,\"altitude\",sep=\"*\", collapse=\"+\"),sep=\"\"))\nfm.GSIF.H <- as.formula(paste(\"Humus ~\", paste(c(sm2D.lst,\"ns(altitude,df=4)\"), collapse=\"+\")))\nfm.GSIF.int.H <- as.formula(paste(\"Humus ~\",paste(paste(sm2D.lst,\"altitude\",sep=\"*\" ,collapse=\"+\"),\"ns(altitude,df=4)\",sep=\"+\")))\nfm.GSIF.int.H1 <- as.formula(paste(\"Humus ~\",paste(paste(sm2D.lst,\"poly(altitude,3)\",sep=\"*\",collapse=\"+\"))))\n#===============================================================================================\n\n#================== test for stratfold3d and penint3D ============================================\nsource(paste(getwd(),\"R\",\"stratFold3D.R\",sep=\"/\"))\nsource(paste(getwd(),\"R\",\"penint3D.R\",sep=\"/\"))\n\nfun<-fm.H\nregdat<-H.df\ncontVar<-sm2D.lst[1:11]\ntargetVar<-\"Humus\"\n\n\nstrat<-stratfold3d(targetVar=\"Humus\",regdat=H.df,folds=6,cent=3,dimensions=\"2D\",IDs=TRUE,sum=TRUE,plot=TRUE)\nflist<-strat$folds\npenint3D(fun=fm.H,regdat=H.df,lambda=10^seq(10,-2,length=100),contVar=contVar,int=TRUE,flist=flist)\n\n#================= test for hierNet modification ===================================================================\nsource(paste(getwd(),\"R\",\"funcs.R\",sep=\"/\"))\n\nH.df[,c(\"altitude\",sm2D.lst[1:11])]<-apply(H.df[,c(\"altitude\",sm2D.lst[1:11])],2,scale)\n\nmm <- model.matrix(fm.H ,H.df)[,-1] #fm.int.lm.As, # fm.GSIF.int.lm.As\nnzv <- nearZeroVar(mm)\nnames(data.frame(mm)[, nzv])\nif(sum(nzv) != 0){mm <- mm[, -nzv]}else{mm <- mm}\n\nH <- H.df$Humus\n\nhnet<-hierNet(x=mm[,c(1:19)],y=H,lam=0.3)#,diagonal=FALSE)#,zz=mm[,20:34])\n\nnn<-names(data.frame(compute.interactions.c(mm[,c(1:19)],diagonal = FALSE)))\nintind<-which(nn %in% grep(\"altitude\", nn, value = TRUE))\nhead(compute.interactions.c(mm[,c(1:19)],diagonal = FALSE)[,intind])\n\ninteractions<-(compute.interactions.c(mm[,c(1:19)],diagonal = FALSE)[,intind])\n\nhierNet.varimp(hnet,x=HTrans.df[,1:13],y=H)\n\nhnet<-hierNet(x=mm[,c(1:19)],y=H,lam=0.3,diagonal=FALSE,zz=interactions)\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1457277663550.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4135876301",
    "id" : "842974C9",
    "lastKnownWriteTime" : 1457291017,
    "last_content_update" : 1457294101061,
    "path" : "D:/_R projects/hierNet/R/test.R",
    "project_path" : "R/test.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}